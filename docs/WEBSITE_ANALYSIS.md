# 勞動法規常見問答網站結構分析

## 分析日期
2025-11-21

## 網站可行性評估

| 網站 | 可爬取 | 反爬蟲機制 | 優先級 |
|------|--------|-----------|--------|
| 勞動部常見問答 | ✅ 是 | 無 | P0 |
| 勞保局常見問答 | ✅ 是 | 無 | P0 |
| 健保署常見問答 | ❌ 否 | Cloudflare | - |
| 職安署常見問答 | ✅ 是 | 無 | P1 |

---

## 1. 勞動部常見問答

**網址**: https://www.mol.gov.tw/1607/28690/2282/nodeListSearch

### 網站架構
- **列表頁**: 表格式列表，包含標題、次分類、發布單位、日期等
- **分頁機制**: ✅ 有（383 筆 / 39 頁，每頁 10 筆，可調整為 20/30/40）
- **詳細頁**: 點擊標題進入獨立頁面

### HTML 結構

#### 列表頁
```html
<table>
  <tr>
    <td>項次</td>
    <td><a href="/1607/28690/2282/.../post">標題</a></td>
    <td>次分類</td>
    <td>發布單位</td>
    <td>發布日期</td>
    <td>更新日期</td>
    <td>點閱人氣</td>
  </tr>
</table>
```

#### 詳細頁結構
- **問題標題**: `<h2>` 標籤
- **答案內容**: 段落式文字，包含超連結
- **相關法規**: 文字中嵌入連結（如：勞動部勞動法令查詢系統）
- **Metadata**:
  - 發布單位: 文字標籤
  - 發布日期: YYYY-MM-DD
  - 更新日期: YYYY-MM-DD
- **附件**: 無（頁面有 `.file_download_custom` CSS class 但未使用）

### 範例頁面
- 列表: https://www.mol.gov.tw/1607/28690/2282/nodeListSearch
- 詳細: https://www.mol.gov.tw/1607/28690/2282/2326/2288/82217/post

### 爬取策略
1. **列表爬取**:
   - 解析表格行
   - 提取標題、URL、次分類、發布單位、日期
   - 處理分頁（39 頁）
2. **詳細頁爬取**:
   - 提取 `<h2>` 問題標題
   - 提取答案段落內容
   - 識別法規連結
   - 提取 metadata
3. **增量更新**: 依據「更新日期」判斷是否需要重新爬取

---

## 2. 勞保局常見問答

**網址**: https://www.bli.gov.tw/0100603.html

### 網站架構
- **目錄頁**: 樹狀結構（主分類 → 次分類 → 細分類 → 問答）
- **分頁機制**: ❌ 無（全部內容以樹狀列表呈現）
- **詳細頁**: 點擊問題進入獨立頁面

### HTML 結構

#### 目錄頁
```html
<ul>
  <li>主分類
    <ul>
      <li>次分類
        <ul>
          <li><a href="/0017380.html">問題標題</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
```

#### 詳細頁結構
- **問題標題**: `<h1>` 標籤（如：「7.受僱勞工要求公司不要幫他辦理勞保...」）
- **答案內容**:
  - 使用 `<h3>` 次標題組織（如：「員工達5人就須強制保勞保」）
  - 包含「小提醒」區塊（系統化說明）
  - 嵌入相關連結（如：就業保險適用對象）
- **相關法規**: 超連結形式
- **Metadata**:
  - 更新日期: 「最後更新日期：YYYY-MM-DD」（底部）
- **附件**: 無直接附件（側邊欄有「書表下載專區」）

### 範例頁面
- 目錄: https://www.bli.gov.tw/0100603.html
- 詳細: https://www.bli.gov.tw/0017380.html

### 爬取策略
1. **目錄解析**:
   - 解析樹狀 `<ul>/<li>` 結構
   - 提取分類層級（主分類、次分類、細分類）
   - 收集所有問答連結
2. **詳細頁爬取**:
   - 提取 `<h1>` 問題
   - 提取答案內容（包含 `<h3>` 次標題）
   - 識別「小提醒」區塊
   - 提取相關法規連結
   - 提取更新日期
3. **分類標記**: 記錄問答所屬的分類路徑

---

## 3. 健保署常見問答 ❌

**網址**: https://www.nhi.gov.tw/ch/sp-qanda-list-1.html

### 問題
- **Cloudflare 防護**: 網站使用 Cloudflare 阻擋自動化請求
- **錯誤訊息**: "Sorry, you have been blocked"
- **可行性**: 需要使用瀏覽器自動化工具（如 Selenium）或放棄此資料源

### 建議
**不建議爬取**，原因：
1. 技術複雜度高（需要模擬真實瀏覽器）
2. 維護成本高（Cloudflare 規則可能變更）
3. 可能違反網站使用條款
4. 有其他優質資料源可替代

---

## 4. 職安署常見問答

**網址**: https://www.osha.gov.tw/48110/48461/48463/nodelist

### 網站架構
- **目錄頁**: 10 個主分類（職業安全衛生管理、作業環境監測等）
- **列表頁**: 每個分類下有問答列表
- **分頁機制**: ✅ 有（如：14 筆 / 2 頁，每頁 10 筆，可調整）
- **詳細頁**: 點擊標題進入獨立頁面

### HTML 結構

#### 目錄頁
```html
<a href="/48110/48461/48463/48465/lpsimplelist">職業安全衛生管理</a>
<a href="/48110/48461/48463/48467/lpsimplelist">作業環境監測</a>
...
```

#### 列表頁
- 標題（超連結）
- 發布單位
- 更新/發布日期
- 點閱次數
- 分頁控制

#### 詳細頁結構
（需進一步測試，預期與勞動部相似）

### 範例頁面
- 目錄: https://www.osha.gov.tw/48110/48461/48463/nodelist
- 列表: https://www.osha.gov.tw/48110/48461/48463/48465/lpsimplelist
- 詳細: https://www.osha.gov.tw/48110/48461/48463/48465/56299/post

### 爬取策略
1. **目錄爬取**:
   - 提取 10 個分類連結
2. **列表爬取**:
   - 解析每個分類的列表頁
   - 處理分頁
   - 提取標題、URL、發布單位、日期
3. **詳細頁爬取**:
   - 結構需進一步分析

---

## 爬取優先順序

### P0 核心資料源（優先實作）
1. **勞動部常見問答** - 383 筆，涵蓋廣泛勞動法規問題
2. **勞保局常見問答** - 數量待確認，專注勞工保險相關

### P1 補充資料源
3. **職安署常見問答** - 約 140+ 筆（10 個分類 × 平均 14 筆），專注職安衛生

### P2 暫緩/放棄
4. **健保署常見問答** - Cloudflare 阻擋，建議放棄

---

## 資料處理建議

### 1. 統一資料格式（JSONL）
```json
{
  "id": "mol_faq_YYYYMMDD_NNNN",
  "source": "mol|bli|osha",
  "category": "主分類",
  "subcategory": "次分類",
  "question": "問題標題",
  "answer": {
    "text": "答案純文字",
    "html": "答案HTML（保留格式）"
  },
  "related_laws": [
    {"name": "法規名稱", "url": "連結"}
  ],
  "metadata": {
    "department": "發布單位",
    "published_date": "YYYY-MM-DD",
    "updated_date": "YYYY-MM-DD",
    "views": 123
  },
  "detail_url": "原始網址"
}
```

### 2. Plain Text 優化策略
基於 FSC 專案經驗，建議：
- **移除網頁雜訊**: 麵包屑、側邊欄、頁尾
- **保留關鍵資訊**:
  - 問題（醒目呈現）
  - 答案（完整內容）
  - 相關法規（名稱+連結）
  - 來源/日期（metadata）
- **格式優化**:
  ```
  問題: [問題標題]
  來源: 勞動部 / [次分類]
  更新日期: YYYY-MM-DD

  答案:
  [答案內容]

  相關法規:
  - [法規名稱](連結)
  ```

### 3. 向量搜尋優化
**最佳上傳內容**:
- ✅ **Plain Text 格式** - 已驗證比 Markdown 效果好 40-60%
- ✅ **問答完整配對** - 問題+答案一起上傳，保持語義完整性
- ✅ **關鍵 Metadata** - 來源、分類、日期（方便篩選）
- ❌ **移除無關資訊** - 點閱數、HTML 標籤、CSS class

**預期效果**:
- 用戶查詢：「公司不幫我保勞保可以嗎」
- 檢索結果：勞保局問答「受僱勞工要求公司不要幫他辦理勞保，想繼續在工會加保，可以嗎？」
- 語義相似度高，精準匹配

---

## 附件處理策略

### 當前狀況
- **勞動部**: 無附件
- **勞保局**: 無直接附件（側邊欄有表單下載，但非問答專屬）
- **職安署**: 待確認

### 建議
✅ **暫不處理附件** - 理由：
1. 當前分析的問答頁面無實質附件
2. 問答內容已足夠完整
3. 側邊欄的表單下載非問答專屬，處理無意義

⚠️ **未來擴充**: 如果發現特定問答有專屬附件（如：檢核表、範本），再啟用附件下載功能

---

## 爬蟲實作計劃

### 階段 1: 基礎架構（1-2 天）
- [ ] 建立專案結構（基於 FSC 架構）
- [ ] 實作 `BaseLaborCrawler` 抽象基類
- [ ] 配置系統（`config/sources.yaml`）
- [ ] JSONL 儲存系統
- [ ] 索引管理系統

### 階段 2: 勞動部爬蟲（2-3 天）
- [ ] 實作 `MOLFaqCrawler`
- [ ] 列表頁解析（表格+分頁）
- [ ] 詳細頁解析（問題+答案+metadata）
- [ ] 測試爬取（前 3 頁，30 筆）
- [ ] 完整爬取（383 筆）

### 階段 3: 勞保局爬蟲（2-3 天）
- [ ] 實作 `BLIFaqCrawler`
- [ ] 樹狀目錄解析
- [ ] 詳細頁解析
- [ ] 測試與完整爬取

### 階段 4: 職安署爬蟲（1-2 天）
- [ ] 實作 `OSHAFaqCrawler`
- [ ] 目錄+列表+詳細頁解析
- [ ] 測試與完整爬取

### 階段 5: Plain Text 優化與上傳（2-3 天）
- [ ] 實作 `LaborFaqPlainTextOptimizer`
- [ ] 測試優化效果（檔案大小、可讀性）
- [ ] 上傳到 Gemini File Search Store
- [ ] 生成 mapping 檔案

### 階段 6: 測試與驗證（1-2 天）
- [ ] RAG 查詢測試
- [ ] 語義檢索準確度驗證
- [ ] 文檔撰寫

**總計**: 9-15 天

---

## 技術挑戰與解決方案

### 挑戰 1: 勞保局樹狀結構解析
**問題**: 多層嵌套的 `<ul>/<li>` 結構
**解決**: 使用遞迴解析，記錄分類路徑

### 挑戰 2: 不同網站的 HTML 結構差異
**問題**: 三個網站的 HTML 結構完全不同
**解決**: 每個網站實作獨立的爬蟲類別，繼承 `BaseLaborCrawler`

### 挑戰 3: 增量更新機制
**問題**: 如何判斷哪些問答需要更新
**解決**:
- 依據「更新日期」比對
- 儲存上次爬取時間到 `metadata.json`
- 只爬取 `updated_date > last_crawl_date` 的項目

### 挑戰 4: 相關法規連結提取
**問題**: 法規連結格式不統一
**解決**:
- 正則表達式匹配法規名稱
- 提取 `<a>` 標籤的 href
- 建立法規名稱標準化映射表

---

## 預期成果

### 資料規模
- **勞動部**: ~383 筆
- **勞保局**: ~200-300 筆（估計）
- **職安署**: ~140 筆
- **總計**: ~700-800 筆

### 資料品質
- ✅ 100% 結構化（JSONL 格式）
- ✅ 完整 Metadata（來源、分類、日期）
- ✅ RAG 優化（Plain Text 格式）
- ✅ 可追溯（保留原始 URL）

### Gemini Store
- **Store 名稱**: `labor-faqs`
- **上傳格式**: Plain Text
- **Mapping 檔案**: `labor_faq_mapping.json`, `gemini_id_mapping.json`

---

## 結論

✅ **可行性**: 高 - 3/4 網站可順利爬取
✅ **資料價值**: 高 - 涵蓋勞動法規、勞保、職安等核心領域
✅ **技術複雜度**: 中 - 基於 FSC 架構可快速實作
✅ **維護成本**: 低 - 政府網站結構穩定

**建議立即開始實作 P0 資料源（勞動部+勞保局）**
